@*
 * This file is part of the Nextbeat services.
 *
 * For the full copyright and license information,
 * please view the LICENSE file that was distributed with this source code.
 *@
@import views.html.helper
@import model.component.util.ViewValuePageLayout
@import play.api.data.Form
@import persistence.post.model.PostSearch
@import model.site.post.SiteViewValueHome


@(vv: SiteViewValueHome, form: Form[PostSearch])(implicit messages: play.api.i18n.Messages)
@import play.api.libs.json.Json

@** 施設検索一覧 *@
@views.html.common.layout.InnerContent("site-app-home", "content") {
@** --[ 検索フォーム ]---------------------------------------------------------- *@
<div class="content__section form">
 @helper.form(action = controllers.home.routes.HomeController.search) {

 @** 作品名 *@
 <div class="form__section pref inline">
  @(helper.inputText(form("query"), '_label -> ""))
 </div>

 @** 登録ボタン *@
 <div class="form__section submit inline">
  <button class="button" type="submit">
   <span class="submit__text">検索</span>
  </button>
 </div>
 }
</div>

@** マップ *@
<div id="wrapper">
 <div id="map"></div>
</div>


<script src="http://maps.google.com/maps/api/js?key=AIzaSyDyJExnzV4eE4GR1cvThMiJVPOWJrLwPG0&language=ja"></script>
<script>
var jsStr = @Html(vv.jsonStr);

var markerData = jsStr;

var map;
var marker = [];
var infoWindow = [];


var geocoder = new google.maps.Geocoder();//Geocode APIを使います。

function initMap() {
 // 地図の作成
 var mapLatLng;
   if(markerData.length > 0){
       mapLatLng = new google.maps.LatLng({lat: markerData[0]['latitude'], lng: markerData[0]['longitude']}); // 緯度経度のデータ作成
    }else{
       mapLatLng = new google.maps.LatLng({lat: 35.646091, lng: 139.714011});
    }
    map = new google.maps.Map(document.getElementById('map'), { // #sampleに地図を埋め込む
     center: mapLatLng, // 地図の中心を指定
      zoom: 15 // 地図のズームを指定
   });

 // マーカー毎の処理
 for (var i = 0; i < markerData.length; i++) {
        markerLatLng = new google.maps.LatLng({lat: markerData[i]['latitude'], lng: markerData[i]['longitude']}); // 緯度経度のデータ作成
        marker[i] = new google.maps.Marker({ // マーカーの追加
         position: markerLatLng, // マーカーを立てる位置を指定
            map: map // マーカーを立てる地図を指定
       });

     infoWindow[i] = new google.maps.InfoWindow({ // 吹き出しの追加
     // 吹き出しに表示する内容
         content:
         '<div class="inner_window_wrapper">' +
            '<div class="left">' +
               '<a href="/post/' + markerData[i]['postId'] + '" style="display: inline-block;">' +
               '<div class="sample">' + markerData[i]['title'] + '</div>' +
                  '<div>' + markerData[i]['content'] + '</div>' +
               '</a>' +
            '</div>' +
            '<div class="right">' +
               '<img src="assets">' +
            '</div>' +

         '</div>'

       });

     markerEvent(i); // マーカーにクリックイベントを追加
 }
}

// マーカーにクリックイベントを追加
function markerEvent(i) {
    marker[i].addListener('click', function() { // マーカーをクリックしたとき
      for (var j = 0; j < markerData.length; j++) {
         if( j != i){
            infoWindow[j].close();
         }
      }
      infoWindow[i].open(map, marker[i]); // 吹き出しの表示
  });
}

initMap();

</script>

}
